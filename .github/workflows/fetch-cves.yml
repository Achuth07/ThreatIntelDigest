name: Automated NVD CVE Fetch

on:
  schedule:
    # Runs at 02:00 UTC every day
    - cron: '0 2 * * *'
  # Allow manual trigger from GitHub UI
  workflow_dispatch:

jobs:
  fetch-cves:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger NVD Data Ingestion Endpoint
        run: |
          echo "Triggering NVD CVE Fetch..."
          response=$(curl -X POST https://www.whatcyber.com/api/fetch-cves \
            -H "Content-Type: application/json" \
            --write-out "%{http_code}" \
            --silent \
            --output /dev/null)
          
          echo "Response Status Code: $response"
          
          if [ "$response" -eq 200 ]; then
            echo "Successfully triggered CVE fetch."
          else
            echo "Failed to trigger CVE fetch. Status: $response"
            exit 1
          fi
