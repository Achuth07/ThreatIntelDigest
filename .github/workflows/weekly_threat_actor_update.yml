name: Weekly Threat Actor Update

on:
  schedule:
    # Run at 04:00 on Sunday
    - cron: '0 4 * * 0'
  workflow_dispatch:

jobs:
  update-threat-actors:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Ingest Threat Actors from MITRE
      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
      run: npx tsx scripts/ingest-threat-actors.ts

    - name: Link Threat Actors to Articles
      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL }}
      run: npx tsx scripts/link-threat-actors.ts
